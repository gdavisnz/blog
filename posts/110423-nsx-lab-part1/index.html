<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploying NSX-T 3.2 in my HomeLab Environment | Grant Davis</title><meta name=keywords content="vmware,homelab,NSX"><meta name=description content="Installation of NSX-T in my HOMELAB"><meta name=author content="Grant Davis"><link rel=canonical href=https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/><meta name=google-site-verification content="XYZabc"><link crossorigin=anonymous href=/blog/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Deploying NSX-T 3.2 in my HomeLab Environment"><meta property="og:description" content="Installation of NSX-T in my HOMELAB"><meta property="og:type" content="article"><meta property="og:url" content="https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/"><meta property="og:image" content="https://gdavisnz.github.io/blog/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-11T00:00:00+00:00"><meta property="og:site_name" content="Grant Davis"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gdavisnz.github.io/blog/cover.png"><meta name=twitter:title content="Deploying NSX-T 3.2 in my HomeLab Environment"><meta name=twitter:description content="Installation of NSX-T in my HOMELAB"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gdavisnz.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"Deploying NSX-T 3.2 in my HomeLab Environment","item":"https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploying NSX-T 3.2 in my HomeLab Environment","name":"Deploying NSX-T 3.2 in my HomeLab Environment","description":"Installation of NSX-T in my HOMELAB","keywords":["vmware","homelab","NSX"],"articleBody":" Introduction NSX-T seems quite daunting in any environment but with a home lab like mine (VMware Workstation + 1 ISP Router) I thought this might not be achievable with the lack of VLAN Tagging and no Jumbo Frames available on my home router. I am not an expert in Networking but I found a great youtube series by Jeffery Kusters located HERE that helps you build a Nested Lab where I managed to get NSX-T functionality.\nNSX-T is technology that complements VMware components like Tanzu, Container Service Extension, NSX ALB etc so I thought I should try and implement it in my lab.\nMy Lab I’ll be quick here since this post is about the NSX-T configuration aspect, but to help with that, I’ll give you a rundown of my lab.\nI have one host deployed and configured on VMware Workstation with as many resources as possible. This host also has 2 Bridged Network Adapters.\nOn that host, I deployed a Jumphost/AD/DNS Server and a VyOS virtual router. This VyOS router has 1 NIC connected to my home network and 1 NIC connected to a Nested-ESXi-Trunk (VLAN 4095) port group on a virtual switch. The NSX-T Edge Controller will also be deployed on this host.\nOn that host, I also have provisioned a vCenter server and 3 Nested ESXi hosts. These hosts will have a Virtual Distributed Switch where our NSX Segments are created.\nESXi Management Host Network config on my Management Host\nESXi Workload Host Network config on my Workload Hosts. nsxt-vds01 is my vds where NSX-T will create segments. vds01 is the vds with all my ESXi Management VLANS/VMKs.\nVyos Virtual Router My vyos virtual router has the following Interfaces configured.\ninterfaces { ethernet eth0 { address 192.168.1.145/24 description Home-Network hw-id 00:0c:29:0f:f8:6f } ethernet eth1 { hw-id 00:0c:29:0f:f8:79 mtu 9000 vif 4 { address 10.0.4.254/24 description vMotion mtu 9000 } vif 6 { address 10.0.6.254/24 description Overlay-TZ mtu 9000 } vif 8 { address 10.0.8.254/24 description VSAN mtu 9000 } vif 10 { address 10.0.10.254/24 description ESXi-Management } vif 11 { address 172.27.11.1/24 description VLAN-TZ mtu 9000 } } loopback lo { } } NSX-T Configuration Compute Manager First thing I did was configure vCenter connectivity. This is done by browsing to System » Fabric » Compute Managers\nTransport Zones Next is to create 2 Transport Zones in System » Fabric » Transport Zones. I need one overlay transport zone and one VLAN transport zone.\nUplink Profiles Next to to create Uplink Profiles (System » Fabric » Profiles), these profiles essentaily map NICs to uplinks in vcenter, you can configure # of uplinks + configure Active/Active or Active Standby Scenarios.\nI created 2 Uplink profiles here\nTEP IP Pools I created an IP Pool (Networking » IP Address Pools) for my VLAN 6 overlay TEP network\nTransport Node Profile I then created a Transport Node Profile (System » Fabric » Hosts » Transport Node Profile) which asks you to create a Host Switch. This is where you tell NSX-T which vSphere VDS it uses, you can also use the N-VDS capability which is a fully managed DVS in NSX-T, this Host Switch configuration Wizard ties the Transport Zones, Uplink Profiles and TEP Pools together.\nPrepare Hosts Now its time to configure your vSphere Environment under System » Fabric » Hosts, I configured mine at a cluster level, you should only need to assign the Transport Profile and youre good to go. This will install the NSX-T agent on each host so can take a while.\nConclusion I have now deployed and configured an NSX-T Manager instance. I then created all the required IP Pools, Uplink profiles, and Transport Nodes to install the NSX agent on my ESXi hosts. Next will be the deployment of Edge Nodes, configure east/west and north/south traffic with Tier 1 and Tier 0 routers with BGP, and create some Segments to test.\n","wordCount":"648","inLanguage":"en","image":"https://gdavisnz.github.io/blog/cover.png","datePublished":"2023-04-11T00:00:00Z","dateModified":"2023-04-11T00:00:00Z","author":{"@type":"Person","name":"Grant Davis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/"},"publisher":{"@type":"Organization","name":"Grant Davis","logo":{"@type":"ImageObject","url":"https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://gdavisnz.github.io/blog/ accesskey=h title="Grant Davis (Alt + H)"><img src=https://gdavisnz.github.io/apple-touch-icon.png alt aria-label=logo height=35>Grant Davis</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://gdavisnz.github.io/blog/about/ title=about><span>about</span></a></li><li><a href=https://gdavisnz.github.io/blog/posts/ title=posts><span>posts</span></a></li><li><a href=https://gdavisnz.github.io/blog/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gdavisnz.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://gdavisnz.github.io/blog/posts/>Posts</a></div><h1 class=post-title>Deploying NSX-T 3.2 in my HomeLab Environment</h1><div class=post-meta><span title='2023-04-11 00:00:00 +0000 UTC'>April 11, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;648 words&nbsp;·&nbsp;Grant Davis</div></header><figure class=entry-cover><img loading=lazy srcset="https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/cover_hu9d7afc79e1ec528337ea9c5c0a69a44b_21141_360x0_resize_box_3.png 360w ,https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/cover_hu9d7afc79e1ec528337ea9c5c0a69a44b_21141_480x0_resize_box_3.png 480w ,https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/cover.png 500w" sizes="(min-width: 768px) 720px, 100vw" src=https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/cover.png alt="Deploying NSX-T 3.2 in my HomeLab Environment" width=500 height=188></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#my-lab>My Lab</a><ul><li><a href=#esxi-management-host>ESXi Management Host</a></li><li><a href=#esxi-workload-host>ESXi Workload Host</a></li><li><a href=#vyos-virtual-router>Vyos Virtual Router</a></li></ul></li><li><a href=#nsx-t-configuration>NSX-T Configuration</a><ul><li><a href=#compute-manager>Compute Manager</a></li><li><a href=#transport-zones>Transport Zones</a></li><li><a href=#uplink-profiles>Uplink Profiles</a></li><li><a href=#tep-ip-pools>TEP IP Pools</a></li><li><a href=#transport-node-profile>Transport Node Profile</a></li><li><a href=#prepare-hosts>Prepare Hosts</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><p><img loading=lazy src=diagram.png alt></p><hr><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><hr><p>NSX-T seems quite daunting in any environment but with a home lab like mine (VMware Workstation + 1 ISP Router) I thought this might not be achievable with the lack of VLAN Tagging and no Jumbo Frames available on my home router. I am not an expert in Networking but I found a great youtube series by Jeffery Kusters located <a href=https://www.youtube.com/@JeffreyKusters>HERE</a> that helps you build a Nested Lab where I managed to get NSX-T functionality.</p><p>NSX-T is technology that complements VMware components like Tanzu, Container Service Extension, NSX ALB etc so I thought I should try and implement it in my lab.</p><hr><h2 id=my-lab>My Lab<a hidden class=anchor aria-hidden=true href=#my-lab>#</a></h2><hr><p>I&rsquo;ll be quick here since this post is about the NSX-T configuration aspect, but to help with that, I&rsquo;ll give you a rundown of my lab.</p><p>I have one host deployed and configured on VMware Workstation with as many resources as possible. This host also has 2 Bridged Network Adapters.</p><p>On that host, I deployed a Jumphost/AD/DNS Server and a VyOS virtual router. This VyOS router has 1 NIC connected to my home network and 1 NIC connected to a Nested-ESXi-Trunk (VLAN 4095) port group on a virtual switch. The NSX-T Edge Controller will also be deployed on this host.</p><p>On that host, I also have provisioned a vCenter server and 3 Nested ESXi hosts. These hosts will have a Virtual Distributed Switch where our NSX Segments are created.</p><h3 id=esxi-management-host>ESXi Management Host<a hidden class=anchor aria-hidden=true href=#esxi-management-host>#</a></h3><p>Network config on my Management Host</p><p><img loading=lazy src=1-Workstation-Host.png alt="Figure 1: Workstation ESXi Host Network Settings"></p><h3 id=esxi-workload-host>ESXi Workload Host<a hidden class=anchor aria-hidden=true href=#esxi-workload-host>#</a></h3><p>Network config on my Workload Hosts. <em>nsxt-vds01</em> is my vds where NSX-T will create segments. <em>vds01</em> is the vds with all my ESXi Management VLANS/VMKs.</p><p><img loading=lazy src=2-nested-esxi.png alt="Figure 2: Nested ESXi Host Network Settings"></p><h3 id=vyos-virtual-router>Vyos Virtual Router<a hidden class=anchor aria-hidden=true href=#vyos-virtual-router>#</a></h3><p>My vyos virtual router has the following Interfaces configured.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>interfaces {
</span></span><span class=line><span class=cl>    ethernet eth0 {
</span></span><span class=line><span class=cl>        address 192.168.1.145/24
</span></span><span class=line><span class=cl>        description Home-Network
</span></span><span class=line><span class=cl>        hw-id 00:0c:29:0f:f8:6f
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    ethernet eth1 {
</span></span><span class=line><span class=cl>        hw-id 00:0c:29:0f:f8:79
</span></span><span class=line><span class=cl>        mtu 9000
</span></span><span class=line><span class=cl>        vif 4 {
</span></span><span class=line><span class=cl>            address 10.0.4.254/24
</span></span><span class=line><span class=cl>            description vMotion
</span></span><span class=line><span class=cl>            mtu 9000
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        vif 6 {
</span></span><span class=line><span class=cl>            address 10.0.6.254/24
</span></span><span class=line><span class=cl>            description Overlay-TZ
</span></span><span class=line><span class=cl>            mtu 9000
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        vif 8 {
</span></span><span class=line><span class=cl>            address 10.0.8.254/24
</span></span><span class=line><span class=cl>            description VSAN
</span></span><span class=line><span class=cl>            mtu 9000
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        vif 10 {
</span></span><span class=line><span class=cl>            address 10.0.10.254/24
</span></span><span class=line><span class=cl>            description ESXi-Management
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        vif 11 {
</span></span><span class=line><span class=cl>            address 172.27.11.1/24
</span></span><span class=line><span class=cl>            description VLAN-TZ
</span></span><span class=line><span class=cl>            mtu 9000
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    loopback lo {
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><hr><h2 id=nsx-t-configuration>NSX-T Configuration<a hidden class=anchor aria-hidden=true href=#nsx-t-configuration>#</a></h2><hr><h3 id=compute-manager>Compute Manager<a hidden class=anchor aria-hidden=true href=#compute-manager>#</a></h3><p>First thing I did was configure vCenter connectivity. This is done by browsing to System &#187; Fabric &#187; Compute Managers</p><p><img loading=lazy src=3-compute-manager.PNG alt="Figure 3: Add vCenter as Compute Manager"></p><h3 id=transport-zones>Transport Zones<a hidden class=anchor aria-hidden=true href=#transport-zones>#</a></h3><p>Next is to create 2 Transport Zones in System &#187; Fabric &#187; Transport Zones. I need one overlay transport zone and one VLAN transport zone.</p><p><img loading=lazy src=4-tz.PNG alt="Figure 4: Creating a Transport Zone"></p><h3 id=uplink-profiles>Uplink Profiles<a hidden class=anchor aria-hidden=true href=#uplink-profiles>#</a></h3><p>Next to to create Uplink Profiles (System &#187; Fabric &#187; Profiles), these profiles essentaily map NICs to uplinks in vcenter, you can configure # of uplinks + configure Active/Active or Active Standby Scenarios.</p><p>I created 2 Uplink profiles here</p><p><img loading=lazy src=5-uplinks.PNG alt="Figure 5: Creating Edge and Host Uplink Profiles"></p><h3 id=tep-ip-pools>TEP IP Pools<a hidden class=anchor aria-hidden=true href=#tep-ip-pools>#</a></h3><p>I created an IP Pool (Networking &#187; IP Address Pools) for my VLAN 6 overlay TEP network</p><p><img loading=lazy src=6-tep1.PNG alt="Figure 6a: Create TEP Pool">
<img loading=lazy src=6-tep2.PNG alt="Figure 6b: Configure Subnet Range"></p><h3 id=transport-node-profile>Transport Node Profile<a hidden class=anchor aria-hidden=true href=#transport-node-profile>#</a></h3><p>I then created a Transport Node Profile (System &#187; Fabric &#187; Hosts &#187; Transport Node Profile) which asks you to create a Host Switch. This is where you tell NSX-T which vSphere VDS it uses, you can also use the N-VDS capability which is a fully managed DVS in NSX-T, this Host Switch configuration Wizard ties the Transport Zones, Uplink Profiles and TEP Pools together.<br><img loading=lazy src=7-hostsw.PNG alt="Figure 7: Transport Node Profile"></p><h3 id=prepare-hosts>Prepare Hosts<a hidden class=anchor aria-hidden=true href=#prepare-hosts>#</a></h3><p>Now its time to configure your vSphere Environment under System &#187; Fabric &#187; Hosts, I configured mine at a cluster level, you should only need to assign the Transport Profile and youre good to go. This will install the NSX-T agent on each host so can take a while.</p><p><img loading=lazy src=8-hostconfig.PNG alt="Figure 8: Host Configuration"></p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>I have now deployed and configured an NSX-T Manager instance. I then created all the required IP Pools, Uplink profiles, and Transport Nodes to install the NSX agent on my ESXi hosts. Next will be the deployment of Edge Nodes, configure east/west and north/south traffic with Tier 1 and Tier 0 routers with BGP, and create some Segments to test.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://gdavisnz.github.io/blog/tags/vmware/>vmware</a></li><li><a href=https://gdavisnz.github.io/blog/tags/homelab/>homelab</a></li><li><a href=https://gdavisnz.github.io/blog/tags/nsx/>NSX</a></li></ul><nav class=paginav><a class=prev href=https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/><span class=title>« Prev</span><br><span>Adding NSX Networking to a VCD Tenancy using IP Spaces</span></a>
<a class=next href=https://gdavisnz.github.io/blog/posts/260323-vcd-cpom/><span class=title>Next »</span><br><span>Centralized Point of Management (CPoM) in Cloud Director 10.4.1</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://gdavisnz.github.io/blog/>Grant Davis</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>