<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Adding NSX Networking to a VCD Tenancy using IP Spaces | Grant Davis</title><meta name=keywords content="vmware,VCD,NSX"><meta name=description content="Adding NSX Networking to a VCD Tenancy utilizing a Private Provider Gateway and Private IP Spaces"><meta name=author content="Grant Davis"><link rel=canonical href=https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/><meta name=google-site-verification content="XYZabc"><link crossorigin=anonymous href=/blog/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Adding NSX Networking to a VCD Tenancy using IP Spaces"><meta property="og:description" content="Adding NSX Networking to a VCD Tenancy utilizing a Private Provider Gateway and Private IP Spaces"><meta property="og:type" content="article"><meta property="og:url" content="https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/"><meta property="og:image" content="https://gdavisnz.github.io/blog/nsx-vcd-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-04T00:00:00+00:00"><meta property="og:site_name" content="Grant Davis"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gdavisnz.github.io/blog/nsx-vcd-cover.png"><meta name=twitter:title content="Adding NSX Networking to a VCD Tenancy using IP Spaces"><meta name=twitter:description content="Adding NSX Networking to a VCD Tenancy utilizing a Private Provider Gateway and Private IP Spaces"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gdavisnz.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"Adding NSX Networking to a VCD Tenancy using IP Spaces","item":"https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Adding NSX Networking to a VCD Tenancy using IP Spaces","name":"Adding NSX Networking to a VCD Tenancy using IP Spaces","description":"Adding NSX Networking to a VCD Tenancy utilizing a Private Provider Gateway and Private IP Spaces","keywords":["vmware","VCD","NSX"],"articleBody":" Introduction IP Spaces is a new IP management service that was introduced in Cloud Director 10.4.1.\nThis feature enables Service Providers to have the capability to control and manage IP address scope, ranges, prefixes, and quotas .You can create different IP scopes and assign them across all tenants without any overlapping or duplication. It also is an improvement when tracking IP usage across tenants.\nNot only are IP Spaces new to me but NSX integration with VCD is as well so I thought I’d spin up a new tenant from scratch and go from there.\nHere is my BoM for this deployment\nComponent Version vCenter Server 8.0.1 (21560480) ESXI 8.0.1 (21495797) NSX 4.1 Cloud Director 10.4.2 Here is what we will go over in this post\nWhats been set up already A working and configured vCenter Server and a working and configured NSX Instance\nI have Deployed and configured VCD. I have added my vcenter server as a compute resource and my NSX Manager as a NSX Resource.\nFor this blog post my Provider Gateway (T0 router) is going to be set as Private, this means a T0 needs to be allocated per individual tenant. This has already been deployed in NSX and configured. Im also going to enable Route Advertisement on my Networks so I have configured BGP pairing to my physical router.\nNetwork Pool First up is creating a Network Pool in VCD, this is done in the Provider Portal.\nThis essentially configures NSX-T backed traffic in VCD to use a specific Geneve backed Transport Zone in NSX.\nIn the Provider Portal go to Resources » Cloud Resources » Network Pools and click New\nGive your Pool a Name and click Next\nNSX 4.X is installed so this deployment will use Geneve Backed as a Network Pool Type and then click Next\nSelect NSX Instance and then click Next Choose the NSX overlay transport zone thats been configured and then click Next Review Settings and then click Finish VCD will now create the Network Pool, this pool is needed to configure your Provider VDC.\nCreate Provider VDC Next is to create a new Provider VDC.\nThis can be done in the Provider Portal under Resources » Cloud Resources » Provider VDCs and clicking on New\nName your Provider VDC and click Next Choose your Cloud Resource (vCenter) and click Next\nChoose the vCenter cluster or resource pool that will map to this Provider VDC and click Next\nChoose your Sotrage Policy and click Next\nChoose the Geneve Backed Network pool we created in the last step and click Next\nReview Settings and then click Finish\nCreate Org Next Step is to create an Organization, At the moment im colour coding all my Tenants so I will call this one ‘Blue’\nThis can be done in the Provider Portal on Resources » Cloud Resources » Organizations\nCreate Provider Gateway Next step is to create the Provider Gateway. This is assigning the T0 router that was created in NSX to my VCD tenant named Blue. Assigning a T0 to a specific tenant is done by setting the Provider Gateway to Private which will be done in the steps below.\nCreating a new Provider Gateway is achieved in the VCD Provider Portal. Resources » Cloud Resources » Provider Gateways, click New\nChoose NSX Manager and click Next\nGive your Provider Gateway a Name and also choose what VCD IP Management capability will be used. In this example we will use IP Spaces, click Next\nSet Provider Gateway to Private and assign to my Blue Organization, click Next\nChoose the NSX t0 router allocated for this Org and click Next\nReview Settings and click Finish Create Private IP Space Creating a IP Space will allow the tenant to request a IP Prefix to use within their OrgVDC, in this example the tenant ‘Blue’ will be allocated a /16 scope which will then be broken up into 255 /24 blocks.\nCreate a IP Space in the Provider Portal. Resources » Cloud Resources » IP Spaces\nThis IP Space will be allocated to the tenant Blue only so choose private, assign the appropriate Org and click Next Give the IP Space a name and click Next\nSince im all configured with BGP, Route Advertisment will be enabled, this means we also need to set up IP Prefixes instead of IP Ranges. Click Next\nScope is defining the /16 network, click Next\nSkip IP Ranges and click Next\nSet the IP Prefixes here, as stated below im going to take that /16 scope and break them up into 255 /24 networks. click Next\nThe IP prefixes need to match the scope of the IP Space.\nReview Settings and click Finish\nYou can now see your IP Space, if you expand IP Prefix you will be able to see all the Sequences.\nCreate IP Space Uplink Since these IP Prefixes are going to be routable to the outside world, A IP Space Uplink needs to be created. This is done by browsing to your Provider Gateway created earlier.\nUnder IP Space Uplinks in your Provider Gateway properties, click New\nProvide a Tenant Facing Name and click Next\nChoose your IP Space, click Next\nReview Settings and click Finish\nYou should see your newly created IP Space Uplink now Create OrgVDC OrgVDC Networks need a OrgVDC so lets create that.\nIn the Provider Portal under Resources » Cloud Resources » Organization VDCs, Click New\nName the OrgVDC, click Next\nAssign OrgVDC to Organization, click Next\nChoose Provider VDC, click Next\nChoose the preferred Allocation Model, click Next\nConfigure the Resource Allocation settings, click Next Add Storage Policies and Quotas, click Next\nChoose the Network Pool, click Next Review Settings, click Finish\nYou should now see your NSX-T backed OrgVDC Create Tenant Edge Gateway Create Edge Gateway for Tenant Blue, This will provision a T1 Gateway in NSX\nCreated in the Provider Portal under Resources » Cloud Resources » Edge Gateways\nClick New\nChoose the OrgVDC, click Next\nName Edge Gateway and enable IP Spaces, click Next\nChoose your Provider Gateway, click Next This is dependant on the NSX configuration but, in this instance the edge cluster linked to the provider T0 will be used, click Next\nReview Settings and click Finish\nIn NSX you will see the Edge Gateway deployed as a T1 Router linked to the T0 Provider Gateway Modify Tenant Default Right Bundle To allow Tenants to create Networks via an IP Space prefix, the Tenant Default Rights Bundle needs to be modified.\nCreate New Network as Tenant A tenant can now log into the Tenant Portal and create their own L3 Routable Network using IP Spaces.\nUnder Networking, click New\nChoose your orgVDC, click Next\n**If there is a need to present a network to multiple OrgVDCs, a Datacenter Group can be created. **\nChoose Routed, click Next\nSpecifiy the Edge Gateway, click Next\nName your Network, under Gateway CIDRs request a IP Prefix from your IP Space\nVCD will then get a Sequence from the IP Space and assign to this network\nSkip Static IP Pools, click Next\nSkip DNS, click Next\nReview Settings, click Next\nThe Network is now visible in the Blue Tenancy, the tenant is now able to build VMs and applications to assign to this network.\nNSX and BGP Verification viewing the IP Space usage and allocation can be done in the Tenant Portal under Networking » IP Spaces\nIn NSX, you can now see your network created as an Overlay Segment.\nAs promised, this network is routable and is showing on my physical router via BGP.\nSummary IP Spaces is a VCD IP management system that allows providers to assign IP interfaces to customers without any duplication and overlapping.\nAnother benefit I can see here is if the Provider provides public IP addresses to customers where they can request and release as needed.\nThank you for reading\n","wordCount":"1319","inLanguage":"en","image":"https://gdavisnz.github.io/blog/nsx-vcd-cover.png","datePublished":"2023-05-04T00:00:00Z","dateModified":"2023-05-04T00:00:00Z","author":{"@type":"Person","name":"Grant Davis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/"},"publisher":{"@type":"Organization","name":"Grant Davis","logo":{"@type":"ImageObject","url":"https://gdavisnz.github.io/blog/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://gdavisnz.github.io/blog/ accesskey=h title="Grant Davis (Alt + H)"><img src=https://gdavisnz.github.io/apple-touch-icon.png alt aria-label=logo height=35>Grant Davis</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://gdavisnz.github.io/blog/about/ title=about><span>about</span></a></li><li><a href=https://gdavisnz.github.io/blog/posts/ title=posts><span>posts</span></a></li><li><a href=https://gdavisnz.github.io/blog/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gdavisnz.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://gdavisnz.github.io/blog/posts/>Posts</a></div><h1 class=post-title>Adding NSX Networking to a VCD Tenancy using IP Spaces</h1><div class=post-meta><span title='2023-05-04 00:00:00 +0000 UTC'>May 4, 2023</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1319 words&nbsp;·&nbsp;Grant Davis</div></header><figure class=entry-cover><img loading=lazy srcset="https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/nsx-vcd-cover_huc96b14c376dc2c1c3f1424d3506ff1c8_28306_360x0_resize_box_3.png 360w ,https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/nsx-vcd-cover_huc96b14c376dc2c1c3f1424d3506ff1c8_28306_480x0_resize_box_3.png 480w ,https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/nsx-vcd-cover.png 500w" sizes="(min-width: 768px) 720px, 100vw" src=https://gdavisnz.github.io/blog/posts/040523-nsx-in-vcd/nsx-vcd-cover.png alt="Adding NSX Networking to a VCD Tenancy using IP Spaces" width=500 height=189></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#whats-been-set-up-already>Whats been set up already</a></li></ul></li><li><a href=#network-pool>Network Pool</a></li><li><a href=#create-provider-vdc>Create Provider VDC</a></li><li><a href=#create-org>Create Org</a></li><li><a href=#create-provider-gateway>Create Provider Gateway</a></li><li><a href=#create-private-ip-space>Create Private IP Space</a></li><li><a href=#create-ip-space-uplink>Create IP Space Uplink</a></li><li><a href=#create-orgvdc>Create OrgVDC</a></li><li><a href=#create-tenant-edge-gateway>Create Tenant Edge Gateway</a></li><li><a href=#modify-tenant-default-right-bundle>Modify Tenant Default Right Bundle</a></li><li><a href=#create-new-network-as-tenant>Create New Network as Tenant</a></li><li><a href=#nsx-and-bgp-verification>NSX and BGP Verification</a></li><li><a href=#summary>Summary</a></li></ul></nav></div></details></div><div class=post-content><hr><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><hr><p>IP Spaces is a new IP management service that was introduced in Cloud Director 10.4.1.</p><p>This feature enables Service Providers to have the capability to control and manage IP address scope, ranges, prefixes, and quotas .You can create different IP scopes and assign them across all tenants without any overlapping or duplication. It also is an improvement when tracking IP usage across tenants.</p><p>Not only are IP Spaces new to me but NSX integration with VCD is as well so I thought I&rsquo;d spin up a new tenant from scratch and go from there.</p><p>Here is my BoM for this deployment</p><table><thead><tr><th style=text-align:center>Component</th><th style=text-align:center>Version</th></tr></thead><tbody><tr><td style=text-align:center>vCenter Server</td><td style=text-align:center>8.0.1 (21560480)</td></tr><tr><td style=text-align:center>ESXI</td><td style=text-align:center>8.0.1 (21495797)</td></tr><tr><td style=text-align:center>NSX</td><td style=text-align:center>4.1</td></tr><tr><td style=text-align:center>Cloud Director</td><td style=text-align:center>10.4.2</td></tr></tbody></table><p>Here is what we will go over in this post</p><h3 id=whats-been-set-up-already>Whats been set up already<a hidden class=anchor aria-hidden=true href=#whats-been-set-up-already>#</a></h3><p>A working and configured vCenter Server and a working and configured NSX Instance</p><p>I have Deployed and configured VCD. I have added my vcenter server as a compute resource and my NSX Manager as a NSX Resource.</p><p>For this blog post my Provider Gateway (T0 router) is going to be set as Private, this means a T0 needs to be allocated per individual tenant. This has already been deployed in NSX and configured. Im also going to enable Route Advertisement on my Networks so I have configured BGP pairing to my physical router.</p><p><img loading=lazy src=1-t0.png alt="Figure 1: T0 router for my Tenant named Blue"></p><hr><h2 id=network-pool>Network Pool<a hidden class=anchor aria-hidden=true href=#network-pool>#</a></h2><hr><p>First up is creating a Network Pool in VCD, this is done in the Provider Portal.</p><p>This essentially configures NSX-T backed traffic in VCD to use a specific Geneve backed Transport Zone in NSX.</p><p>In the Provider Portal go to Resources &#187; Cloud Resources &#187; Network Pools and click <strong>New</strong></p><p>Give your Pool a Name and click Next</p><p><img loading=lazy src=2-newnwp.png alt="Figure 2: New Network Pool"></p><p>NSX 4.X is installed so this deployment will use <strong>Geneve Backed</strong> as a Network Pool Type and then click <strong>Next</strong></p><p><img loading=lazy src=3-newnptype.png alt="Figure 3: Choose Network Pool Type "></p><p>Select NSX Instance and then click <strong>Next</strong>
<img loading=lazy src=4-newnpprovider.png alt="Figure 4: NSX instance "></p><p>Choose the NSX overlay transport zone thats been configured and then click <strong>Next</strong>
<img loading=lazy src=5-newnptz.png alt="Figure 5: Choose Transport Zone "></p><p>Review Settings and then click <strong>Finish</strong>
<img loading=lazy src=6-newnpfinish.png alt="Figure 6: Review Settings "></p><p>VCD will now create the Network Pool, this pool is needed to configure your Provider VDC.</p><hr><h2 id=create-provider-vdc>Create Provider VDC<a hidden class=anchor aria-hidden=true href=#create-provider-vdc>#</a></h2><hr><p>Next is to create a new Provider VDC.</p><p>This can be done in the Provider Portal under Resources &#187; Cloud Resources &#187; Provider VDCs and clicking on <strong>New</strong></p><p>Name your Provider VDC and click <strong>Next</strong>
<img loading=lazy src=7-pvdcgeneral.png alt="Figure 7: Name Provider VDC "></p><p>Choose your Cloud Resource (vCenter) and click <strong>Next</strong></p><p><img loading=lazy src=8-pvdcprovider.png alt="Figure 8: Choose Provider "></p><p>Choose the vCenter cluster or resource pool that will map to this Provider VDC and click <strong>Next</strong></p><p><img loading=lazy src=9-pvdcrp.png alt="Figure 9: Select Cluster "></p><p>Choose your Sotrage Policy and click <strong>Next</strong></p><p><img loading=lazy src=10-pvdcstorage.png alt="Figure 10: Storage Policy "></p><p>Choose the Geneve Backed Network pool we created in the last step and click <strong>Next</strong></p><p><img loading=lazy src=11-pvdcnwp.png alt="Figure 11: Network Pool "></p><p>Review Settings and then click <strong>Finish</strong></p><hr><h2 id=create-org>Create Org<a hidden class=anchor aria-hidden=true href=#create-org>#</a></h2><hr><p>Next Step is to create an Organization, At the moment im colour coding all my Tenants so I will call this one &lsquo;Blue&rsquo;</p><p>This can be done in the Provider Portal on Resources &#187; Cloud Resources &#187; Organizations</p><p><img loading=lazy src=12-org.png alt="Figure 12: Create Org "></p><hr><h2 id=create-provider-gateway>Create Provider Gateway<a hidden class=anchor aria-hidden=true href=#create-provider-gateway>#</a></h2><hr><p>Next step is to create the Provider Gateway. This is assigning the T0 router that was created in NSX to my VCD tenant named Blue. Assigning a T0 to a specific tenant is done by setting the Provider Gateway to Private which will be done in the steps below.</p><p>Creating a new Provider Gateway is achieved in the VCD Provider Portal. Resources &#187; Cloud Resources &#187; Provider Gateways, click <strong>New</strong></p><p><img loading=lazy src=13-pgnew.png alt="Figure 13: New Provider Gateway "></p><p>Choose NSX Manager and click <strong>Next</strong></p><p><img loading=lazy src=14-pgnsx.png alt="Figure 14: Choose NSX-T "></p><p>Give your Provider Gateway a Name and also choose what VCD IP Management capability will be used. In this example we will use IP Spaces, click <strong>Next</strong></p><p><img loading=lazy src=15-pggen.png alt="Figure 15: Name Provider Gateway "></p><p>Set Provider Gateway to Private and assign to my Blue Organization, click <strong>Next</strong></p><p><img loading=lazy src=16-pgownership.png alt="Figure 16: Make Private "></p><p>Choose the NSX t0 router allocated for this Org and click <strong>Next</strong></p><p><img loading=lazy src=17-pgt0.png alt="Figure 17: Choose T0 "></p><p>Review Settings and click <strong>Finish</strong>
<img loading=lazy src=18-pgfinish.png alt="Figure 18: Review Settings"></p><hr><h2 id=create-private-ip-space>Create Private IP Space<a hidden class=anchor aria-hidden=true href=#create-private-ip-space>#</a></h2><hr><p>Creating a IP Space will allow the tenant to request a IP Prefix to use within their OrgVDC, in this example the tenant &lsquo;Blue&rsquo; will be allocated a /16 scope which will then be broken up into 255 /24 blocks.</p><p>Create a IP Space in the Provider Portal. Resources &#187; Cloud Resources &#187; IP Spaces</p><p><img loading=lazy src=19-ipsnew.png alt="Figure 19: New IP Space"></p><p>This IP Space will be allocated to the tenant Blue only so choose private, assign the appropriate Org and click <strong>Next</strong>
<img loading=lazy src=20-ipstype.png alt="Figure 20: Make IP Space Private"></p><p>Give the IP Space a name and click <strong>Next</strong></p><p><img loading=lazy src=21-ipsgeneral.png alt="Figure 21: Name IP Space "></p><p>Since im all configured with BGP, <strong>Route Advertisment</strong> will be enabled, this means we also need to set up IP Prefixes instead of IP Ranges. Click <strong>Next</strong></p><p><img loading=lazy src=22-ipsnw.png alt="Figure 22: Enable Route Advertisement "></p><p>Scope is defining the /16 network, click <strong>Next</strong></p><p><img loading=lazy src=23-ipsscope.png alt="Figure 23: Enter Scope "></p><p>Skip IP Ranges and click <strong>Next</strong></p><p><img loading=lazy src=24-ipsrange.PNG alt="Figure 24: IP Ranges "></p><p>Set the IP Prefixes here, as stated below im going to take that /16 scope and break them up into 255 /24 networks. click <strong>Next</strong></p><p><strong>The IP prefixes need to match the scope of the IP Space.</strong></p><p><img loading=lazy src=25-ipsprefix.png alt="Figure 25: IP Prefixes "></p><p>Review Settings and click <strong>Finish</strong></p><p><img loading=lazy src=26-ipsreview.png alt="Figure 26: Review Settings "></p><p>You can now see your IP Space, if you expand IP Prefix you will be able to see all the Sequences.</p><p><img loading=lazy src=27-ss.png alt="Figure 27: Review Settings "></p><hr><h2 id=create-ip-space-uplink>Create IP Space Uplink<a hidden class=anchor aria-hidden=true href=#create-ip-space-uplink>#</a></h2><hr><p>Since these IP Prefixes are going to be routable to the outside world, A IP Space Uplink needs to be created. This is done by browsing to your Provider Gateway created earlier.</p><p><img loading=lazy src=28-uplinknew.png alt="Figure 28: Create IP Space Uplink "></p><p>Under IP Space Uplinks in your Provider Gateway properties, click <strong>New</strong></p><p><img loading=lazy src=29-uplinkblue.png alt="Figure 29: Provider Gateway Properties"></p><p>Provide a Tenant Facing Name and click <strong>Next</strong></p><p><img loading=lazy src=30-uplinkcreate.png alt="Figure 30: Name Uplink "></p><p>Choose your IP Space, click <strong>Next</strong></p><p><img loading=lazy src=31-uplinkips.png alt="Figure 31: Choose IP Space "></p><p>Review Settings and click <strong>Finish</strong></p><p><img loading=lazy src=32-uplinkready.png alt="Figure 32: Review Settings "></p><p>You should see your newly created IP Space Uplink now
<img loading=lazy src=33-uplinksview.png alt="Figure 33: Review Settings"></p><hr><h2 id=create-orgvdc>Create OrgVDC<a hidden class=anchor aria-hidden=true href=#create-orgvdc>#</a></h2><hr><p>OrgVDC Networks need a OrgVDC so lets create that.</p><p>In the Provider Portal under Resources &#187; Cloud Resources &#187; Organization VDCs, Click <strong>New</strong></p><p><img loading=lazy src=34-orgvdcnew.png alt="Figure 34: New OrgVDC "></p><p>Name the OrgVDC, click <strong>Next</strong></p><p><img loading=lazy src=35-orgvdcgen.png alt="Figure 35: Name OrgVDC "></p><p>Assign OrgVDC to Organization, click <strong>Next</strong></p><p><img loading=lazy src=36-orgvdcorg.png alt="Figure 36: Choose Org "></p><p>Choose Provider VDC, click <strong>Next</strong></p><p><img loading=lazy src=37-orgvdcpvdc.png alt="Figure 37: Provider VDC "></p><p>Choose the preferred Allocation Model, click <strong>Next</strong></p><p><img loading=lazy src=38-orgvdcmodel.png alt="Figure 38: Allocation Model"></p><p>Configure the Resource Allocation settings, click <strong>Next</strong>
<img loading=lazy src=39-orgvdcfex.png alt="Figure 39: Resource Allocation"></p><p>Add Storage Policies and Quotas, click <strong>Next</strong></p><p><img loading=lazy src=40-orgvdcsp.png alt="Figure 40: Storage Policies"></p><p>Choose the Network Pool, click <strong>Next</strong>
<img loading=lazy src=41-orgvdcnp.png alt="Figure 41: Network Pool "></p><p>Review Settings, click <strong>Finish</strong></p><p><img loading=lazy src=42-orgvdcready.png alt="Figure 42: Review Settings"></p><p>You should now see your NSX-T backed OrgVDC
<img loading=lazy src=43-orgvdclist.png alt="Figure 43: NSX-T backed OrgVDC "></p><hr><h2 id=create-tenant-edge-gateway>Create Tenant Edge Gateway<a hidden class=anchor aria-hidden=true href=#create-tenant-edge-gateway>#</a></h2><hr><p>Create Edge Gateway for Tenant Blue, This will provision a T1 Gateway in NSX</p><p>Created in the Provider Portal under Resources &#187; Cloud Resources &#187; Edge Gateways</p><p>Click <strong>New</strong></p><p><img loading=lazy src=44-egwview.png alt="Figure 44: New Edge Gateway "></p><p>Choose the OrgVDC, click <strong>Next</strong></p><p><img loading=lazy src=45-egworgvdc.png alt="Figure 45: OrgVDC "></p><p>Name Edge Gateway and enable IP Spaces, click <strong>Next</strong></p><p><img loading=lazy src=46-egwgen.png alt="Figure 46: Name Edge Gateway "></p><p>Choose your Provider Gateway, click <strong>Next</strong>
<img loading=lazy src=47-egwpgw.png alt="Figure 47: Provider Gateway"></p><p>This is dependant on the NSX configuration but, in this instance the edge cluster linked to the provider T0 will be used, click <strong>Next</strong></p><p><img loading=lazy src=48-egwec.png alt="Figure 48: Edge Cluster ">
Review Settings and click <strong>Finish</strong></p><p><img loading=lazy src=49-egwcomplete.png alt="Figure 49: Review Settings "></p><p>In NSX you will see the Edge Gateway deployed as a T1 Router linked to the T0 Provider Gateway
<img loading=lazy src=50-egwnsx.png alt="Figure 50: Edge Gateway Summary "></p><hr><h2 id=modify-tenant-default-right-bundle>Modify Tenant Default Right Bundle<a hidden class=anchor aria-hidden=true href=#modify-tenant-default-right-bundle>#</a></h2><hr><p>To allow Tenants to create Networks via an IP Space prefix, the Tenant Default Rights Bundle needs to be modified.</p><p><img loading=lazy src=51-tenrb.png alt="Figure 51: Tenant Default Right Bundle"></p><hr><h2 id=create-new-network-as-tenant>Create New Network as Tenant<a hidden class=anchor aria-hidden=true href=#create-new-network-as-tenant>#</a></h2><hr><p>A tenant can now log into the Tenant Portal and create their own L3 Routable Network using IP Spaces.</p><p>Under Networking, click <strong>New</strong></p><p><img loading=lazy src=52-nwtenant.png alt="Figure 52: New Network"></p><p>Choose your orgVDC, click <strong>Next</strong></p><p>**If there is a need to present a network to multiple OrgVDCs, a Datacenter Group can be created. **</p><p><img loading=lazy src=53-nwtscope.png alt="Figure 53: OrgVDC"></p><p>Choose Routed, click <strong>Next</strong></p><p><img loading=lazy src=54-nwttype.png alt="Figure 54:Routed "></p><p>Specifiy the Edge Gateway, click <strong>Next</strong></p><p><img loading=lazy src=55-nwtedge.png alt="Figure 55: Edge Gateway"></p><p>Name your Network, under Gateway CIDRs request a IP Prefix from your IP Space</p><p><img loading=lazy src=56-nwtgen.png alt="Figure 56:  Request a IP Prefix from your IP Space"></p><p>VCD will then get a Sequence from the IP Space and assign to this network</p><p><img loading=lazy src=57-nwtallocate.png alt="Figure 57: IP Prefix Allocation "></p><p><img loading=lazy src=58-nwtassigned.png alt="Figure 58: IP Prefix Confirmation"></p><p>Skip Static IP Pools, click <strong>Next</strong></p><p><img loading=lazy src=59-nwtstatic.png alt="Figure 59: Static IP Pools"></p><p>Skip DNS, click <strong>Next</strong></p><p><img loading=lazy src=60-nwtdns.png alt="Figure 60: DNS"></p><p>Review Settings, click <strong>Next</strong></p><p><img loading=lazy src=61nwt-ready.png alt="Figure 61: Review Settings"></p><p>The Network is now visible in the Blue Tenancy, the tenant is now able to build VMs and applications to assign to this network.</p><p><img loading=lazy src=62-nwtverify.png alt="Figure 62: Network"></p><hr><h2 id=nsx-and-bgp-verification>NSX and BGP Verification<a hidden class=anchor aria-hidden=true href=#nsx-and-bgp-verification>#</a></h2><hr><p>viewing the IP Space usage and allocation can be done in the Tenant Portal under Networking &#187; IP Spaces</p><p><img loading=lazy src=63-lease.png alt="Figure 63: IP Space usage and allocation"></p><p>In NSX, you can now see your network created as an Overlay Segment.</p><p><img loading=lazy src=64-sumnsx.png alt="Figure 64: Overlay Segment"></p><p>As promised, this network is routable and is showing on my physical router via BGP.</p><p><img loading=lazy src=65-sumbgp.png alt="Figure 65: BGP Route "></p><hr><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><hr><p>IP Spaces is a VCD IP management system that allows providers to assign IP interfaces to customers without any duplication and overlapping.</p><p>Another benefit I can see here is if the Provider provides public IP addresses to customers where they can request and release as needed.</p><p>Thank you for reading</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://gdavisnz.github.io/blog/tags/vmware/>vmware</a></li><li><a href=https://gdavisnz.github.io/blog/tags/vcd/>VCD</a></li><li><a href=https://gdavisnz.github.io/blog/tags/nsx/>NSX</a></li></ul><nav class=paginav><a class=prev href=https://gdavisnz.github.io/blog/posts/070523-alb-vcd/><span class=title>« Prev</span><br><span>LBaaS with NSX Advanced Load Balancer and Cloud Director</span></a>
<a class=next href=https://gdavisnz.github.io/blog/posts/110423-nsx-lab-part1/><span class=title>Next »</span><br><span>Deploying NSX-T 3.2 in my HomeLab Environment</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://gdavisnz.github.io/blog/>Grant Davis</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>